(function(){typeof Backbone!=="undefined"||alert("backbone environment not loaded");typeof $!=="undefined"||alert("jquery environment not loaded");Backbone.UI=Backbone.UI||{KEYS:{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},IMAGE_DIR_PATH:"/images"};_(Backbone.View.prototype).extend({resolveContent:function(a,c,d){return _(d).exists()&&_(c).exists()?_(c).resolveProperty(d):
_(a).exists()&&_(a).isFunction()?a(c):a}});_.mixin({nameForIndex:function(a,c){return a.length===1?"first last":c===0?"first":c===a.length-1?"last":"middle"},exists:function(a){return!_(a).isNull()&&!_(a).isUndefined()},resolveProperty:function(a,c){var d=null;if(_(c).exists()&&_(c).isString()){var f=c.split(".");_(f).each(function(c){if(_(a).exists()){var f=d||a;d=_(f.get).isFunction()?f.get(c):f[c]}})}return d},setProperty:function(a,c,d){if(c){var f=c.split(".");_(f.slice(0,f.length-2)).each(function(c){!_(a).isNull()&&
!_(a).isUndefined()&&(a=_(a.get).isFunction()?a.get(c):a[c])});a&&(_(a.set).isFunction()?(f={},f[c]=d,a.set(f)):a[c]=d)}}});_($.fn).extend({alignTo:function(a,c,d,f){_.each(this,function(e){if(e.style.display=="none"){var j=!0;$(e).css({position:"absolute",top:"-10000px",left:"-10000px",display:"block"})}var g,h,k=a;g=c;h=$(e);k=$(k);g=g||"";var i=k.offset();k={width:k.width(),height:k.height()};h.offset();var l={width:h.width(),height:h.height()};h=g.indexOf("-left")>=0?i.left:g.indexOf("left")>=
0?i.left-l.width:g.indexOf("-right")>=0?i.left+b.width-l.width:g.indexOf("right")>=0?i.left+k.width:i.left+(k.width-l.width)/2;i=g.indexOf("-top")>=0?i.top:g.indexOf("top")>=0?i.top-l.height:g.indexOf("-bottom")>=0?i.top+k.height-l.height:g.indexOf("bottom")>=0?i.top+k.height:i.top+(k.height-l.height)/2;g.indexOf("no-constraint");h+=d||0;i+=f||0;g={x:h,y:i};$(e).css({position:"absolute",left:Math.round(g.x)+"px",top:Math.round(g.y)+"px"});j&&$(e).hide()})},safeAttr:function(a){_(a).exists()&&_(this).each(function(c){a.className&&
($(c).addClass(a.className),delete a.className);$(c).attr(a)})},autohide:function(a){_.each(this,function(c){a=_.extend({leaveOpen:!1,hideCallback:!1,ignoreInputs:!1,ignoreKeys:[],leaveOpenTargets:[]},a||{});c._autoignore=!0;setTimeout(function(){c._autoignore=!1;$(c).removeAttr("_autoignore")},0);if(!c._autohider)c._autohider=_.bind(function(d){var f=d.target;if(!a.ignoreInputs||!/input|textarea|select|option/i.test(f.nodeName))if(!c._autoignore&&(!d.type||!d.type.match(/keypress/)||!_.include(a.ignoreKeys,
d.keyCode)))if(a.hideCallback?a.hideCallback(c):1)$(c).hide(),$(document).bind("click",c._autohider),$(document).bind("keypress",c._autohider),c._autohider=null},this),$(document).bind("click",c._autohider),$(document).bind("keypress",c._autohider)})}});_($).extend({ui:function(){var a=Backbone.UI[arguments[0]],c=m.apply(this,_(arguments).toArray().slice(1));a&&_(a).isFunction()&&(widget=(new a(c.attributes||{})).render(),_(c.children).each(function(a){widget.el.appendChild(a)}));return widget},el:function(){var a=
document.createElement(arguments.length===0?"div":arguments[0]),c=m.apply(this,_(arguments).toArray().slice(1));$(a).safeAttr(c.attributes);_(c.children).each(function(c){a.appendChild(c)});return a},stack:function(){var a="10px",c=$.el("span",{className:"stack"}),d=m.apply(this,_(arguments).toArray());if(d.attributes.padding)a=d.attributes.padding,delete d.attributes.padding;$(c).safeAttr(d.attributes);var f=d.children;_(f).each(function(d,j){var g=j==f.length-1,h=d.el?d.el:d;h.nodeType&&($(h).css({marginBottom:g?
"0":a}),c.appendChild(h))});return c},flow:function(){var a="10px",c=$.el("div",{className:"flow"}),d=m.apply(this,_(arguments).toArray());if(d.attributes.padding)a=d.attributes.padding,delete d.attributes.padding;$(c).safeAttr(d.attributes);d=d.children;var f=-1,e;for(e=0;e<d.length;e++){var j=d[e];if(!_(j).isElement()&&j.textContent=="spring"){f=e;break}}j=f<0?d.length:f;for(e=d.length-1;e>j;e--){var g=d[e];$(g).css({"float":"right",marginLeft:a});e===0&&$(g).addClass("last");h&&h.nextChild?c.insertBefore(g,
h.nextChild):c.appendChild(g);var h=g}for(e=0;e<j;e++)h=d[e].el?d[e].el:d[e],$(h).css({"float":"left",marginRight:e!==j-1?a:null}),e===0&&$(h).addClass("first"),e===j-1&&f===-1&&$(h).addClass("last"),c.appendChild(h);c.appendChild($.el("br",{style:"clear:both;height:0px;line-height:0px"}));return c}});var m=function(){var a={},c=[];arguments.length>0&&(c=n(arguments[0]),c||(a=arguments[0],arguments.length>1&&(c=n(arguments[1]))));return{attributes:a,children:c}},n=function(a){var c;if(a)if(_(a).isElement())c=
[a];else if(_(a).isArray()){c=[];for(var d=0;d<a.length;d++)c.push(_(a[d]).isElement()?a[d]:document.createTextNode(a[d]))}else if(_(a).isString()||_(a).isNumber())c=[document.createTextNode(a)];return c}})();
(function(){window.Backbone.UI.Button=Backbone.View.extend({options:{tagName:"a",className:"button",label:null,disabled:!1,active:!1,glyph:null,glyphRight:null,hasBorder:!0,onClick:null,isSubmit:!1},initialize:function(){_.extend(this,Backbone.UI.HasGlyph);_.bindAll(this,"render");$(this.el).mousedown(_.bind(function(){$(this.el).addClass("active")},this));$(this.el).mouseup(_.bind(function(){$(this.el).removeClass("active")},this));$(this.el).click(_.bind(function(a){if(!this.options.active&&!this.options.disabled&&
this.options.onClick)this.options.onClick(a);return!1},this))},render:function(){var a=this.options.label;_(this.model).exists()&&_(this.options.property).exists()&&(a="change:"+this.options.property,this.model.unbind(a,this.render),this.model.bind(a,this.render),a=_(this.model).resolveProperty(this.options.property));$(this.el).empty();$(this.el).addClass("button");$(this.el).toggleClass("has_border",this.options.hasBorder);this.options.isSubmit&&this.el.appendChild($.el("input",{type:"submit",value:""}));
this.el.appendChild($.el("span",{className:"label"},a));this.insertGlyph(this.el,this.options.glyph);this.insertGlyphRight(this.el,this.options.glyphRight);$(this.el).toggleClass("no_label",!this.options.label);this.setEnabled(!this.options.disabled);this.setActive(this.options.active);return this},setEnabled:function(a){a?this.el.href="#":this.el.removeAttribute("href");this.options.disabled=!a;$(this.el)[a?"removeClass":"addClass"]("disabled")},setActive:function(a){this.options.active=a;$(this.el)[a?
"addClass":"removeClass"]("active")}})})();
(function(){window.Backbone.UI.Checkbox=Backbone.View.extend({options:{tagName:"a",className:"checkbox",model:null,property:null,label:null,checked:!1,onClick:null},initialize:function(){_.bindAll(this,"render");$(this.el).click(_(this._onClick).bind(this));$(this.el).attr({href:"#"});$(this.el).addClass("checkbox")},render:function(){this.checked=_(this.checked).exists()?this.checked:_(this.options.checked).exists()?this.options.checked:!1;var a=this.options.label;if(_(this.model).exists()&&_(this.options.property).exists()){var b=
"change:"+this.options.property;this.model.unbind(b,this.render);this.model.bind(b,this.render);this.checked=_(this.model).resolveProperty(this.options.property)}_(this.model).exists()&&_(this.options.labelProperty).exists()&&(a="change:"+this.options.labelProperty,this.model.unbind(a,this.render),this.model.bind(a,this.render),a=_(this.model).resolveProperty(this.options.labelProperty));$(this.el).empty();b=$.el("div",{className:"checkmark"});this.checked&&b.appendChild($.el("div",{className:"checkmark_fill"}));
this._label=$.el("div",{className:"label"},a);this.el.appendChild(b);this.el.appendChild(this._label);this.el.appendChild($.el("br",{style:"clear:both"}));return this},_onClick:function(){this.checked=!this.checked;_(this.model).exists()&&_(this.options.property).exists()?_(this.model).setProperty(this.options.property,this.checked):this.render();return!1}})})();
(function(){window.Backbone.UI.CollectionView=Backbone.View.extend({initialize:function(){this.model&&(this.model.bind("add",_.bind(this._onModelAdded,this)),this.model.bind("change",_.bind(this._onModelChanged,this)),this.model.bind("remove",_.bind(this._onModelRemoved,this)),this.model.bind("refresh",_.bind(this.render,this)));this._itemViews={}},render:function(){},_onModelAdded:function(){this.render()},_onModelChanged:function(){},_onModelRemoved:function(){this.render()}})})();
(function(){Backbone.UI.DragSession=function(a){this.options=_.extend({dragEvent:null,scope:null,onClick:jQuery.noop,onStart:jQuery.noop,onMove:jQuery.noop,onStop:jQuery.noop,onAbort:jQuery.noop,onDone:jQuery.noop},a);Backbone.UI.DragSession.currentSession&&Backbone.UI.DragSession.currentSession.abort();this._doc=this.options.scope||document;this._handleEvent=_.bind(this._handleEvent,this);this._handleEvent(this.options.dragEvent);this._activate(!0);this.options.dragEvent.stopPropagation();Backbone.UI.DragSession.currentSession=
this};_.extend(Backbone.UI.DragSession,{SLOP:2,BASIC_DRAG_CLASSNAME:"dragging",enableBasicDragSupport:function(a){a=a?a.document||a:document;if(!a._basicDragSupportEnabled)a._basicDragSupportEnabled=!0,$(a).bind("mousedown",function(a){var d=a.target;if(!/(input|textarea|button|select|option)/i.exec(d.nodeName)&&d.hasClassName){var b=d.hasClassName("draggable")?d:d.up(".draggable");if(b=b?b.up(".draggable-container")||b:null){var f=zen.util.Dom.getViewport(b.ownerDocument),e=b.getBounds();new zen.util.DragSession({dragEvent:a,
scope:b.ownerDocument,onStart:function(a){c&&c.blur&&c.blur();a.pos=b.positionedOffset();$(b).addClass(Backbone.UI.DragSession.BASIC_DRAG_CLASSNAME)},onMove:function(a){e.moveTo(a.pos.left+a.dx,a.pos.top+a.dy).constrainTo(f);b.style.left=$px(e.x);b.style.top=$px(e.y)},onDone:function(){c&&c.focus&&c.focus();b.removeClassName(Backbone.UI.DragSession.BASIC_DRAG_CLASSNAME)}});var c=document.activeElement}}})}});_.extend(Backbone.UI.DragSession.prototype,{stop:function(){this._stop()},abort:function(){this._stop(!0)},
_activate:function(a){a=a?"bind":"unbind";$(this._doc)[a]("mousemove",this._handleEvent);$(this._doc)[a]("mouseup",this._handleEvent);$(this._doc)[a]("keyup",this._handleEvent)},_handleEvent:function(a){a.stopPropagation();a.preventDefault();this.x=a.pageX;this.y=a.pageY;if(a.type=="mousedown")this.xStart=this.x,this.yStart=this.y;this.dx=this.x-this.xStart;this.dy=this.y-this.yStart;switch(a.type){case "mousemove":if(this._dragging)this.options.onMove(this,a);else if(this.dx*this.dx+this.dy*this.dy>=
Backbone.UI.DragSession.SLOP*Backbone.UI.DragSession.SLOP)this._dragging=!0,this.options.onStart(this,a);break;case "mouseup":if(this._dragging)this.stop();else this.options.onClick(this,a);break;case "keyup":if(a.keyCode!=Event.KEY_ESC)break;this.abort()}},_stop:function(a){Backbone.UI.DragSession.currentSession=null;this._activate(!1);if(this._dragging){if(a)this.options.onAbort(this);else this.options.onStop(this);this.options.onDone(this)}}})})();
(function(){Backbone.UI.HasCollectionProperty={collection:[],selectedItem:null,selectedValue:null,_determineSelectedItem:function(){var a;if(_(this.model).exists()&&_(this.options.property).exists()&&(a=_(this.model).resolveProperty(this.options.property),_(this.options.valueProperty).exists())){var b=_(this.options.collection.models||this.options.collection).detect(function(b){return(b.attributes||b)[this.options.valueProperty]==a},this);_(b).isUndefined()||(a=b)}return a||this.options.selectedItem},
_setSelectedItem:function(a){this.selectedItem=this.selectedValue=a;if(_(this.model).exists()&&_(this.options.property).exists())this.selectedValue=this._valueForItem(a),_(this.model).setProperty(this.options.property,this.selectedValue)},_valueForItem:function(a){return _(this.options.valueProperty).exists()?_(a).resolveProperty(this.options.valueProperty):a}}})();
(function(){Backbone.UI.HasGlyph={GLYPH_SIZE:22,insertGlyph:function(b,a){return this._insertGlyph(b,a,!1)},insertGlyphRight:function(b,a){return this._insertGlyph(b,a,!0)},_insertGlyph:function(b,a,d){var e=d?"has_glyph_right":"has_glyph";if(!a||!b)return $(b).removeClass(e),null;$(b).addClass(e);e="glyph "+a+(d?" right":"");if(a.length==1)a=$.el("span",{className:e,style:"margin: 0 8px 0 0"},a),b.insertBefore(a,d?null:b.firstChild);else{var c=new Image;$(c).hide();c.onload=function(){var b=Math.max(1,
(28-c.height)/2),a=Math.max(3,(28-c.width)/2);$(c).css({top:b+"px",left:d?"auto":a+"px",right:d?a+"px":"auto"});$(c).show()};c.src=Backbone.UI.IMAGE_DIR_PATH+"/glyphs/"+a+".png";c.className=e;b.insertBefore(c,d?null:b.firstChild)}return c}}})();
(function(){window.Backbone.UI.List=Backbone.UI.CollectionView.extend({options:{className:"list",labelProperty:null,itemView:null,emptyContent:null,onItemClick:jQuery.noop},initialize:function(){Backbone.UI.CollectionView.prototype.initialize.call(this,arguments)},render:function(){$(this.el).empty();var b=$.el("ul");if(!_(this.model).exists()||this.model.length===0){var a=this.options.emptyContent;b.appendChild($.el("li",_(a).isFunction()?a():a))}else _(this.model.models).each(function(a){var c;
c=_(this.options.itemView).exists()?(new this.options.itemView({model:a})).render().el:this.resolveContent(null,a,this.options.labelProperty);item=$.el("li",c);b.appendChild(item);this.options.onItemClick&&$(item).click(_(this.options.onItemClick).bind(this,a));b.appendChild(item)},this);this.el.appendChild((new Backbone.UI.Scroller({content:$.el("div",b)})).render().el);return this}})})();
(function(){window.Backbone.UI.Pulldown=Backbone.View.extend({options:{className:"pulldown",placeholder:"Select...",model:null,property:null,selectedItem:null,collection:[],labelProperty:"label",valueProperty:null,newModel:null,emptyModel:null,glyphProperty:null,glyphRightProperty:null,alignRight:!1,onChange:jQuery.noop,onMenuShow:jQuery.noop,onMenuHide:jQuery.noop},initialize:function(){_(this).extend(Backbone.UI.HasGlyph);_(this).extend(Backbone.UI.HasCollectionProperty);_(this).bindAll("render");
$(this.el).addClass("pulldown")},button:null,menu:null,selectedItem:null,render:function(){$(this.el).empty();_(this.model).exists()&&_(this.model.bind).isFunction()&&(this.model.unbind("change",this.render),_(this.options.property).exists()&&this.model.bind("change:"+this.options.property,this.render));_(this.options.collection).exists()&&_(this.options.collection.bind).isFunction()&&(this.options.collection.unbind("all",this.render),this.options.collection.bind("all",this.render));this._renderMenu();
this.selectedItem=this._determineSelectedItem()||this.options.selectedItem;this.button=(new Backbone.UI.Button({className:"pulldown_button",label:this._labelForItem(this.selectedItem),glyph:_(this.selectedItem).resolveProperty(this.options.glyphProperty),glyphRight:"\u25bc",onClick:_.bind(this._onPulldownClick,this)})).render();this.el.appendChild(this.button.el);return this},setEnabled:function(a){this.button&&this.button.setEnabled(a)},_labelForItem:function(a){return!_(a).exists()?this.options.placeholder:
_(a).resolveProperty(this.options.labelProperty)},setSelectedItem:function(a){this._setSelectedItem(a);this.button.options.label=this._labelForItem(a);this.button.options.glyph=_(a).resolveProperty(this.options.glyphProperty);this.button.render()},hideMenu:function(a){$(this._scroller.el).hide();if(this.options.onMenuHide)this.options.onMenuHide(a)},showMenu:function(a){var b=this.button.el,c=(this.options.alignRight?"-right":"-left")+($(window).height()-($(b).offset().top-document.body.scrollTop)<
150?"top":" bottom");$(this._scroller.el).show();$(this._scroller.el).alignTo(b,c,0,1);$(this._scroller.el).autohide({ignoreKeys:[Backbone.UI.KEYS.KEY_UP,Backbone.UI.KEYS.KEY_DOWN],ignoreInputs:!0,hideCallback:_.bind(this._onAutoHide,this)});$(this._scroller.el).css({width:Math.max($(this.button.el).innerWidth(),this._menuWidth)});if(this.options.onMenuShow)this.options.onMenuShow(a);this._scroller.setScrollRatio(0)},_renderMenu:function(){this._scroller&&(this._scroller.el.parentNode.removeChild(this._scroller.el),
$(this._scroller.el).css({width:"auto"}));var a=$.el("ul",{className:"pulldown_menu"});if(_(this.options.newModel).exists()){var b=this._labelForItem(this.options.newModel)||"";b=$.el("a",{href:"#"},$.el("span",b));$(b).click(_(this._onAddNewItem).bind(this));a.appendChild($.el("li",{className:"new_item"},b))}var c=this.options.emptyModel;_(c).exists()&&(b=this._labelForItem(c),b=$.el("a",{href:"#"},$.el("span",b)),$(b).click(_.bind(function(){this._setSelectedItem(null);this.hideMenu();this._updateButtonWithItem(c);
if(this.options.onChange)this.options.onChange(c);return!1},this)),a.appendChild($.el("li",{className:"new_item"},b)));b=_(this.options.collection).exists()?this.options.collection.models||this.options.collection:[];_(b).each(function(b){this._addItemToMenu(a,b)},this);this._scroller=(new Backbone.UI.Scroller({content:a})).render();$(this._scroller.el).hide();$(this._scroller.el).addClass("pulldown_menu_scroller");document.body.appendChild(this._scroller.el);this._menuWidth=$(this._scroller.el).width()+
20},_addItemToMenu:function(a,b){var c=$.el("a",{href:"#"},$.el("span",this._labelForItem(b)||"\u00a0")),d;this.options.glyphProperty&&(d=_(b).resolveProperty(this.options.glyphProperty),Backbone.UI.HasGlyph.insertGlyph(c,d));this.options.glyphRightProperty&&(d=_(b).resolveProperty(this.options.glyphRightProperty),Backbone.UI.HasGlyph.insertGlyphRight(c,d));d=$.el("li",c);$(c).bind("click",_.bind(function(){this.hideMenu();this._setSelectedItem(b);this._updateButtonWithItem(b);if(this.options.onChange)this.options.onChange(b);
return!1},this));a.appendChild(d)},_updateButtonWithItem:function(a){$(this.el).removeClass("placeholder");this.button.options.label=this._labelForItem(a);this.button.options.glyph=_(a).resolveProperty(this.options.glyphProperty);this.button.render()},_onAddNewItem:function(){var a=this.options.newModel,b=this._labelForItem(a);_(a).setProperty(this.options.labelProperty,"");this._setSelectedItem(a);if(this.options.onChange)this.options.onChange(a);this.hideMenu();$(this.el).removeClass("placeholder");
this._newItemText=$.ui("TextField",{className:"new_item_text",model:a,property:this.options.labelProperty}).render();this._cancelNewItemButton=$.ui("Button",{className:"new_item_cancel",label:"\u2716",onClick:_(this._onCancelNewItem).bind(this,b)}).render();this.el.appendChild(this._newItemText.el);this.el.appendChild(this._cancelNewItemButton.el);this._newItemText.input.focus();$(this.button.el).css({visibility:"hidden"});return!1},_onCancelNewItem:function(a){_(this.options.newModel).setProperty(this.options.labelProperty,
a);this._setSelectedItem(null);a=this._newItemText.el;_(a).exists()&&a.parentNode&&a.parentNode.removeChild(a);a=this._cancelNewItemButton.el;_(a).exists()&&a.parentNode&&a.parentNode.removeChild(a);$(this.button.el).css({visibility:"visible"});this.render()},_onPulldownClick:function(a){$(this._scroller.el).is(":visible")?this.hideMenu(a):this.showMenu(a)},_onAutoHide:function(){if(this.options.onMenuHide)this.options.onMenuHide();return!0}})})();
(function(){window.Backbone.UI.RadioGroup=Backbone.View.extend({options:{className:"radio_group",collection:[],model:null,property:null,labelProperty:"label",valueProperty:null,selectedItem:null,onChange:jQuery.noop},initialize:function(){_.extend(this,Backbone.UI.HasCollectionProperty);_.extend(this,Backbone.UI.HasGlyph);$(this.el).addClass("radio_group")},selectedItem:null,render:function(){this.selectedItem=this._determineSelectedItem();$(this.el).empty();var a=$.el("ul");_.each(this.options.collection,
function(c){var b=this.selectedValue==this._valueForItem(c),d=_(c).resolveProperty(this.options.labelProperty);b=$.el("li",[$.el("a",{className:"choice",href:"#"},[$.el("div",{className:"mark"},b?"\u25cf":""),$.el("div",{className:"label"},d),$.el("br",{style:"clear:both"})]),$.el("br",{style:"clear:both"})]);a.appendChild(b);$(b).bind("click",_.bind(this._onChange,this,c))},this);this.el.appendChild(a);return this},_onChange:function(a){this._setSelectedItem(a);this.render();if(_(this.options.onChange).isFunction())this.options.onChange(a);
return!1}})})();
(function(){window.Backbone.UI.Scroller=Backbone.View.extend({options:{className:"scroller",content:null,scrollAmount:5,onScroll:null},initialize:function(){Backbone.UI.DragSession.enableBasicDragSupport()},render:function(){$(this.el).empty();$(this.el).addClass("scroller");this._scrollContent=this.options.content;$(this._scrollContent).addClass("content");this._knob=$.el("div",{className:"knob"},[$.el("div",{className:"knob_top"}),$.el("div",{className:"knob_middle"}),$.el("div",{className:"knob_bottom"})]);
this._tray=$.el("div",{className:"tray"});this._tray.appendChild(this._knob);this._scrollContentWrapper=$.el("div",{className:"content_wrapper"});this._scrollContentWrapper.appendChild(this._scrollContent);this.el.appendChild(this._tray);this.el.appendChild(this._scrollContentWrapper);this.el.tabIndex=-1;$(this._knob).bind("mousedown",_.bind(this._onKnobMouseDown,this));$(this._tray).bind("click",_.bind(this._onTrayClick,this));$(this.el).bind("mousewheel",_.bind(this._onMouseWheel,this));$(this.el).bind($.browser.msie?
"keyup":"keypress",_.bind(this._onKeyPress,this));$(this.el).addClass("disabled");setInterval(_(this.update).bind(this),40);return this},scrollRatio:function(){return this.scrollPosition()/(this._totalHeight-this._visibleHeight)},setScrollRatio:function(a){var b=this._totalHeight-this._visibleHeight;a=Math.max(0,Math.min(b>0?1:0,a));this._scrollContent.scrollTop=Math.round(a*b);if(this.options.onScroll)this.options.onScroll();setTimeout(_.bind(this._updateKnobPosition,this),0)},scrollBy:function(a){this.setScrollPosition(this.scrollPosition()+
a)},scrollPosition:function(){return this._scrollContent.scrollTop},setScrollPosition:function(a){var b=this._totalHeight-this._visibleHeight;this.setScrollRatio(b?a/b:0)},scrollToEnd:function(){this.setScrollRatio(1)},update:function(){var a=this._scrollContent.offsetHeight,b=this._scrollContent.scrollHeight;if(this._visibleHeight!=a||this._totalHeight!=b)if(this._disabled=b<=a+2,$(this.el).toggleClass("disabled",this._disabled),this._visibleHeight=a,this._totalHeight=b,this._totalHeight>=this._visibleHeight)this._updateKnobSize(),
this.minY=0,this.maxY=$(this._tray).height()-$(this._knob).height()},_updateKnobPosition:function(){var a=this.minY+(this.maxY-this.minY)*this.scrollRatio();if(!isNaN(a))this._knob.style.top=a+"px"},_updateKnobSize:function(){var a=$(this._tray).height()*(this._visibleHeight/this._totalHeight);a=a>20?a:20;$(this._knob).css({height:a+"px"})},_knobRatio:function(a){a=a||this._knob.offsetTop;a=Math.max(this.minY,Math.min(this.maxY,a));return(a-this.minY)/(this.maxY-this.minY)},_onTrayClick:function(a){a=
a||event;a.target==this._tray&&this.setScrollRatio(this._knobRatio((a.layerY||a.y)-this._knob.offsetHeight/2));a.stopPropagation()},_onKnobMouseDown:function(a){this.el.focus();new Backbone.UI.DragSession({dragEvent:a,scope:this.el.ownerDocument,onStart:_.bind(function(a){a.pos=this._knob.offsetTop;a.scroller=this;$(this.el).addClass("dragging")},this),onMove:_.bind(function(a){this.setScrollRatio(this._knobRatio(a.pos+a.dy))},this),onStop:_.bind(function(){$(this.el).removeClass("dragging")},this)});
a.stopPropagation()},_onMouseWheel:function(a,b){if(!this._disabled){var c=this.options.scrollAmount;this.setScrollPosition(this.scrollPosition()-b*c);a.preventDefault();return!1}},_onKeyPress:function(a){switch(a.keyCode){case Backbone.UI.KEYS.KEY_DOWN:this.scrollBy(this.options.scrollAmount);break;case Backbone.UI.KEYS.KEY_UP:this.scrollBy(-this.options.scrollAmount);break;case Backbone.UI.KEYS.KEY_PAGEDOWN:this.scrollBy(this.options.scrollAmount);break;case Backbone.UI.KEYS.KEY_PAGEUP:this.scrollBy(-this.options.scrollAmount);
break;case Backbone.UI.KEYS.KEY_HOME:this.setScrollRatio(0);break;case Backbone.UI.KEYS.KEY_END:this.setScrollRatio(1);break;default:return}a.stopPropagation();a.preventDefault()}})})();
(function(){Backbone.UI.TabSet=Backbone.View.extend({options:{className:"tab_set",tabs:[]},initialize:function(){_.extend(this,Backbone.UI.HasGlyph)},render:function(){$(this.el).empty();this._tabs=[];this._contents=[];this._callbacks=[];this._tabBar=$.el("div",{className:"tab_bar"});this._contentContainer=$.el("div",{className:"content_container"});this.el.appendChild(this._tabBar);this.el.appendChild(this._contentContainer);for(var a=0;a<this.options.tabs.length;a++)this.addTab(this.options.tabs[a]);
this.activateTab(0);return this},addTab:function(a){var b=$.el("a",{href:"#",className:"tab"});a.glyphRight&&this.insertGlyph(b,a.glyphRight);b.appendChild(document.createTextNode(a.label));a.glyph&&this.insertGlyph(b,a.glyph);this._tabBar.appendChild(b);this._tabs.push(b);var c=a.content.nodeType?a.content:$.el("div",a.content);this._contents.push(c);$(c).hide();this._contentContainer.appendChild(c);var d=this._tabs.length-1;$(b).bind("click",_.bind(function(){this.activateTab(d);return!1},this));
this._callbacks.push(a.onActivate||jQuery.noop)},activateTab:function(a){_(this._contents).each(function(a){$(a).hide()});_(this._tabs).each(function(a){$(a).removeClass("selected")});$(this._tabs[a]).addClass("selected");$(this._contents[a]).show();this._callbacks[a]()}})})();
(function(){window.Backbone.UI.TableView=Backbone.UI.CollectionView.extend({options:{className:"table_view",columns:[],emptyContent:"no entries",onItemClick:jQuery.noop},initialize:function(){Backbone.UI.CollectionView.prototype.initialize.call(this,arguments)},render:function(){$(this.el).empty();$(this.el).toggleClass("clickable",this.options.onItemClick!==jQuery.noop);var f=$.el("tr");_(this.options.columns).each(function(a,d,b){var c=_(a.label).isFunction()?a.label():a.label;a=a.width?"width:"+
a.width+"px":null;f.appendChild($.el("th",{className:_(b).nameForIndex(d),style:a},$.el("div",{className:"wrapper",style:a},c)))});this.el.appendChild($.el("table",{className:"heading"},$.el("thead",f)));var c=$.el("tbody");if(this.model.length===0){var e=this.options.emptyContent;c.appendChild($.el("tr",{colspan:this.options.columns.length},_(e).isFunction()?e():e))}else this.model.each(function(a){var d=$.el("tr");_(this.options.columns).each(function(b,c,e){var f=b.width?"width:"+b.width+"px":
null;b=this.resolveContent(b.content,a,b.property);d.appendChild($.el("td",{className:_(e).nameForIndex(c),style:f},$.el("div",{className:"wrapper"},b)))},this);this.options.onItemClick&&$(d).click(_(this.options.onItemClick).bind(this,a));c.appendChild(d)},this);this._collectionView=$.el("table");this._collectionView.appendChild(c);this.el.appendChild((new Backbone.UI.Scroller({content:$.el("div",this._collectionView)})).render().el);return this}})})();
(function(){window.Backbone.UI.TextArea=Backbone.View.extend({options:{className:"text_area",model:null,property:null,textAreaId:null,disabled:!1,value:null,tabIndex:null},textArea:null,initialize:function(){_.extend(this,Backbone.UI.HasGlyph)},render:function(){var a=(this.textArea&&this.textArea.value.length)>0?this.textArea.value:!_(this.options.value).isNull()?this.options.value:this.model&&this.options.property?_(this.model).resolveProperty(this.options.property):null;$(this.el).empty();this.textArea=
$.el("textarea",{id:this.options.textAreaId,tabIndex:this.options.tabIndex,placeholder:this.options.placeholder},a);this._scroller=(new Backbone.UI.Scroller({content:this.textArea})).render();this.insertGlyphRight(this.el,this.options.glyphRight);this.el.appendChild(this._scroller.el);this.insertGlyph(this.el,this.options.glyph);this.setEnabled(!this.options.disabled);$(this.textArea).keyup(_.bind(function(){_.defer(_(this._updateModel).bind(this))},this));return this},setValue:function(a){$(this.textArea).empty();
this.textArea.value=a;this._updateModel()},setEnabled:function(a){a?$(this.el).removeClass("disabled"):$(this.el).addClass("disabled");this.textArea.disabled=!a},_updateModel:function(){_(this.model).setProperty(this.options.property,this.textArea.value)}})})();
(function(){window.Backbone.UI.TextField=Backbone.View.extend({options:{className:"text_field",model:null,property:null,disabled:!1,type:"text",name:null,value:null,label:null,tabIndex:null,onKeyPress:jQuery.noop},input:null,initialize:function(){_.extend(this,Backbone.UI.HasGlyph);this.model&&this.options.property&&this.model.bind("change:"+this.options.property,_.bind(function(){var a=this.model.get(this.options.property);if(this.input&&this.input.value!=a)this.input.value=this.model.get(this.options.property)},
this))},render:function(){var a=(this.input&&this.input.value.length)>0?this.input.value:!_(this.options.value).isNull()?this.options.value:this.model&&this.options.property?_(this.model).resolveProperty(this.options.property):null;$(this.el).empty();$(this.el).addClass("text_field");this.input=$.el("input",{type:this.options.type,name:this.options.name,id:this.options.name,tabIndex:this.options.tabIndex,placeholder:this.options.placeholder,value:a});$(this.input).keyup(_.bind(function(a){_.defer(_(this._updateModel).bind(this));
if(_(this.options.onKeyPress).exists()&&_(this.options.onKeyPress).isFunction())this.options.onKeyPress(a)},this));this.insertGlyphRight(this.el,this.options.glyphRight);this.el.appendChild($.el("div",{className:"input_wrapper"},this.input));this.insertGlyph(this.el,this.options.glyph);this.setEnabled(!this.options.disabled);this.options.label&&$(this.options.label).attr({"for":this.options.name});return this},getValue:function(){return this.input.value},setValue:function(a){this.input.value=a;this._updateModel()},
setEnabled:function(a){a?$(this.el).removeClass("disabled"):$(this.el).addClass("disabled");this.input.disabled=!a},_updateModel:function(){_(this.model).setProperty(this.options.property,this.input.value)}})})();
